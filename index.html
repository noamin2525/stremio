<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>מרכז כתוביות ותוספים ל‑Stremio — גרסת PRO</title>
  <meta name="description" content="התקנה מהירה של תוספי כתוביות ווידאו ל‑Stremio, בדיקת זמינות בזמן אמת, מדריך אינטראקטיבי, שיתוף, דירוג קהילתי, ומצב PWA." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10' fill='%230f9bff'/%3E%3Ccircle cx='12' cy='10' r='3' fill='white'/%3E%3C/svg%3E"/>
  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --text:#111827;
      --muted:#5b6673;
      --brand:#0f9bff;
      --brand-2:#7c3aed; /* accent */
      --stroke:#e6e9ee;
      --radius:14px;
      --shadow:0 6px 18px rgba(16,24,40,.06);
      --ok:#16a34a; --bad:#ef4444; --warn:#f59e0b;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0f141a; --panel:#141b23; --text:#e8eef5; --muted:#a9b7c6; --brand:#7dc3ff; --stroke:#283241; --shadow:0 10px 24px rgba(0,0,0,.35);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;letter-spacing:.2px}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1024px;margin:0 auto;padding:20px}
    header{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.85);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid var(--stroke)}
    @media (prefers-color-scheme: dark){ header{background:rgba(20,27,35,.75)} }
    .bar{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:10px 0}
    .logo{display:flex;gap:10px;align-items:center;font-weight:900;font-size:18px}
    .logo svg{width:26px;height:26px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--stroke);background:var(--panel);color:var(--text);padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);display:inline-flex;align-items:center;gap:8px;font-weight:800;cursor:pointer;transition:.15s transform ease}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;border-color:transparent}
    .btn.small{padding:8px 12px}
    .btn.pill{border-radius:999px}
    .hero{padding:26px 0 10px}
    .hero h1{margin:0 0 6px;font-size:28px}
    .hero p{margin:0;color:var(--muted)}
    .notice{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px dashed var(--stroke);border-radius:12px;margin-top:10px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:16px}
    .card{grid-column:span 12;background:var(--panel);border:1px solid var(--stroke);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);position:relative;overflow:hidden}
    @media (min-width:720px){ .card.span-6{grid-column:span 6} }
    .card h3{margin:0 0 6px;font-size:18px}
    .card p{margin:0 0 10px;color:var(--muted)}
    .pill{display:inline-flex;gap:8px;align-items:center;font-size:12px;font-weight:800;border:1px solid var(--stroke);padding:6px 10px;border-radius:999px;color:var(--muted)}
    .status{display:inline-flex;align-items:center;gap:6px;margin-inline-start:6px}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--muted)}
    .dot.ok{background:var(--ok)} .dot.bad{background:var(--bad)} .dot.warn{background:var(--warn)}
    .section-title{display:flex;align-items:center;gap:10px;margin:22px 0 8px}
    .section-title svg{width:22px;height:22px}
    .input{width:100%;padding:12px 14px;border-radius:12px;background:var(--panel);border:1px solid var(--stroke);color:var(--text);outline:none}
    .addon-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .addon-link{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;word-break:break-all}
    details{border:1px dashed var(--stroke);border-radius:12px;padding:10px 12px}
    details summary{cursor:pointer;font-weight:800}
    .list{padding-inline-start:18px;margin:0}
    .list li{margin:6px 0}
    .rate{display:flex;gap:4px;align-items:center}
    .star{cursor:pointer;font-size:18px;filter:grayscale(1) opacity(.5)}
    .star.on{filter:none;opacity:1}
    /* רקע ויזואלי עדין לכרטיסי וידאו */
    .video-bg{position:absolute;inset:0;opacity:.08;pointer-events:none;background-position:center;background-size:cover}

    /* מדריך אינטראקטיבי (מודאל) */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.35);z-index:60}
    .modal.open{display:grid}
    .modal .sheet{width:min(720px,96vw);max-height:86vh;overflow:auto;background:var(--panel);border:1px solid var(--stroke);border-radius:18px;box-shadow:var(--shadow);padding:16px}

    /* כפתור צף */
    .fab{position:fixed;bottom:calc(16px + env(safe-area-inset-bottom));left:16px;z-index:50;display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:999px;background:#229ED9;color:#fff;font-weight:900;text-decoration:none;box-shadow:0 10px 24px rgba(0,0,0,.18)}
    .fab:hover{transform:translateY(-1px)}
    .fab .label-short{display:none}
    @media (max-width:480px){ .fab .label{display:none} .fab .label-short{display:inline} .fab{padding:12px} }

    /* פס התקדמות קטן בעת ניסיון פתיחת stremio:// */
    .progress{display:none;height:3px;background:linear-gradient(90deg,var(--brand),var(--brand-2));width:0%;border-radius:999px;transition:width .8s ease}
    .progress.running{display:block}
  </style>
</head>
<body>
  <header>
    <div class="container bar" role="banner">
      <div class="logo" title="מרכז כתוביות ל‑Stremio">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" role="img">
          <path d="M4 8a8 8 0 0116 0v5.5a6.5 6.5 0 01-13 0V8" stroke="currentColor" stroke-width="1.6"/>
          <circle cx="12" cy="9.5" r="2.6" stroke="currentColor" stroke-width="1.6"/>
        </svg>
        <span>מרכז כתוביות ל‑Stremio — PRO</span>
      </div>
      <div class="actions">
        <a class="btn" href="#guide" id="open-guide">מדריך אינטראקטיבי</a>
        <a class="btn primary" href="https://www.strem.io/download?platform=windows&four=true" target="_blank" rel="noopener">הורדה ל‑Windows</a>
      </div>
    </div>
    <div class="progress" id="open-progress" aria-hidden="true"></div>
  </header>

  <section class="hero container">
    <h1>התקנה מהירה של תוספים + בדיקת זמינות חיה</h1>
    <p>לחיצה על “התקנה ב‑Stremio” תנסה לפתוח את האפליקציה. אם לא נפתח תוך שניות — מוצג טיפ חלופי והקישור המלא להעתקה.</p>
    <div class="notice" id="proto-notice" aria-live="polite">בודקים אם הדפדפן מזהה פרוטוקול <span class="k">stremio://</span>…</div>
  </section>

  <main class="container" role="main">
    <div class="section-title">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M5 4h14v16H5z" stroke="currentColor" stroke-width="1.6"/><path d="M5 9h14" stroke="currentColor" stroke-width="1.6"/></svg>
      <h2 id="subs">תוספי כתוביות מומלצים</h2>
    </div>

    <div class="grid" id="addons-grid">
      <!-- OpenSubtitles Pro -->
      <article class="card span-6" data-addon>
        <div class="video-bg" aria-hidden="true" style="background-image:radial-gradient(circle at 30% 20%, rgba(15,155,255,.22), transparent 60%)"></div>
        <div class="pill">כתוביות • OpenSubtitles <span class="status"><span class="dot" aria-hidden="true"></span><span class="status-text">בודק…</span></span></div>
        <h3>OpenSubtitles Pro</h3>
        <p>תוסף פופולרי לכתוביות במספר שפות.</p>
        <div class="addon-actions">
          <a class="btn primary small pill open-stremio" href="stremio://opensubtitlesv3-pro.dexter21767.com/eyJsYW5ncyI6WyJoZWJyZXciXSwic291cmNlIjoiYWxsIiwiYWlUcmFuc2xhdGVkIjpmYWxzZSwiYXV0b0FkanVzdG1lbnQiOnRydWV9/manifest.json">התקנה ב‑Stremio</a>
          <button class="btn small copy" data-copy="stremio://opensubtitlesv3-pro.dexter21767.com/eyJsYW5ncyI6WyJoZWJyZXciXSwic291cmNlIjoiYWxsIiwiYWlUcmFuc2xhdGVkIjpmYWxzZSwiYXV0b0FkanVzdG1lbnQiOnRydWV9/manifest.json">העתק קישור</button>
          <button class="btn small share" data-title="OpenSubtitles Pro" data-url="stremio://opensubtitlesv3-pro.dexter21767.com/eyJsYW5ncyI6WyJoZWJyZXciXSwic291cmNlIjoiYWxsIiwiYWlUcmFuc2xhdGVkIjpmYWxzZSwiYXV0b0FkanVzdG1lbnQiOnRydWV9/manifest.json">שתף</button>
        </div>
        <details style="margin-top:8px"><summary>להציג את כתובת התוסף</summary>
          <div class="addon-link">stremio://opensubtitlesv3-pro.dexter21767.com/eyJsYW5ncyI6WyJoZWJyZXciXSwic291cmNlIjoiYWxsIiwiYWlUcmFuc2xhdGVkIjpmYWxzZSwiYXV0b0FkanVzdG1lbnQiOnRydWV9/manifest.json</div>
        </details>
        <div class="rate" aria-label="דירוג קהילתי" data-key="rate:opensubs">
          <span>דירוג:</span>
          <span class="star" role="button" aria-label="1 כוכב">★</span>
          <span class="star" role="button" aria-label="2 כוכבים">★</span>
          <span class="star" role="button" aria-label="3 כוכבים">★</span>
          <span class="star" role="button" aria-label="4 כוכבים">★</span>
          <span class="star" role="button" aria-label="5 כוכבים">★</span>
          <span class="avg" aria-live="polite"></span>
        </div>
      </article>

      <!-- Wizdom Subtitles -->
      <article class="card span-6" data-addon>
        <div class="pill">כתוביות • קהילה <span class="status"><span class="dot" aria-hidden="true"></span><span class="status-text">בודק…</span></span></div>
        <h3>Wizdom Subtitles (V2)</h3>
        <p>מקור כתוביות נוסף.</p>
        <div class="addon-actions">
          <a class="btn primary small pill open-stremio" href="stremio://4b139a4b7f94-wizdom-stremio-v2.baby-beamup.club/manifest.json">התקנה ב‑Stremio</a>
          <button class="btn small copy" data-copy="stremio://4b139a4b7f94-wizdom-stremio-v2.baby-beamup.club/manifest.json">העתק קישור</button>
          <button class="btn small share" data-title="Wizdom Subtitles (V2)" data-url="stremio://4b139a4b7f94-wizdom-stremio-v2.baby-beamup.club/manifest.json">שתף</button>
        </div>
        <details style="margin-top:8px"><summary>להציג את כתובת התוסף</summary>
          <div class="addon-link">stremio://4b139a4b7f94-wizdom-stremio-v2.baby-beamup.club/manifest.json</div>
        </details>
        <div class="rate" aria-label="דירוג קהילתי" data-key="rate:wizdom">
          <span>דירוג:</span>
          <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span>
          <span class="avg" aria-live="polite"></span>
        </div>
      </article>

      <!-- Ktuvit -->
      <article class="card span-6" data-addon>
        <div class="pill">כתוביות • עברית <span class="status"><span class="dot" aria-hidden="true"></span><span class="status-text">בודק…</span></span></div>
        <h3>Ktuvit Subtitles</h3>
        <p>מתמקד בכתוביות בעברית.</p>
        <div class="addon-actions">
          <a class="btn primary small pill open-stremio" href="stremio://4b139a4b7f94-ktuvit-stremio.baby-beamup.club/manifest.json">התקנה ב‑Stremio</a>
          <button class="btn small copy" data-copy="stremio://4b139a4b7f94-ktuvit-stremio.baby-beamup.club/manifest.json">העתק קישור</button>
          <button class="btn small share" data-title="Ktuvit Subtitles" data-url="stremio://4b139a4b7f94-ktuvit-stremio.baby-beamup.club/manifest.json">שתף</button>
        </div>
        <details style="margin-top:8px"><summary>להציג את כתובת התוסף</summary>
          <div class="addon-link">stremio://4b139a4b7f94-ktuvit-stremio.baby-beamup.club/manifest.json</div>
        </details>
        <div class="rate" aria-label="דירוג קהילתי" data-key="rate:ktuvit">
          <span>דירוג:</span>
          <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span>
          <span class="avg" aria-live="polite"></span>
        </div>
      </article>

      <!-- Hebrew Telegram Subtitles -->
      <article class="card span-6" data-addon>
        <div class="pill">כתוביות • טלגרם <span class="status"><span class="dot" aria-hidden="true"></span><span class="status-text">בודק…</span></span></div>
        <h3>Hebrew Telegram Subtitles</h3>
        <p>תוסף כתוביות המבוסס על קבוצת הטלגרם.</p>
        <div class="addon-actions">
          <a class="btn primary small pill open-stremio" href="stremio://stremio7rd-hebrew-telegram-subtitles.vercel.app/manifest.json">התקנה ב‑Stremio</a>
          <button class="btn small copy" data-copy="stremio://stremio7rd-hebrew-telegram-subtitles.vercel.app/manifest.json">העתק קישור</button>
          <button class="btn small share" data-title="Hebrew Telegram Subtitles" data-url="stremio://stremio7rd-hebrew-telegram-subtitles.vercel.app/manifest.json">שתף</button>
        </div>
        <details style="margin-top:8px"><summary>להציג את כתובת התוסף</summary>
          <div class="addon-link">stremio://stremio7rd-hebrew-telegram-subtitles.vercel.app/manifest.json</div>
        </details>
        <div class="rate" aria-label="דירוג קהילתי" data-key="rate:heb-tg">
          <span>דירוג:</span>
          <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span>
          <span class="avg" aria-live="polite"></span>
        </div>
      </article>

      <!-- AIostreams -->
      <article class="card span-6" data-addon>
        <div class="video-bg" aria-hidden="true" style="background-image:radial-gradient(circle at 70% 20%, rgba(124,58,237,.22), transparent 60%)"></div>
        <div class="pill">וידאו <span class="status"><span class="dot" aria-hidden="true"></span><span class="status-text">בודק…</span></span></div>
        <h3>AIostreams (Elfhosted)</h3>
        <p>תוסף לסרטים וסדרות.</p>
        <div class="addon-actions">
          <a class="btn primary small pill open-stremio" href="stremio://noamin25-aiostreams.elfhosted.com/stremio/a9b22ed7-e337-4471-9480-a66f64f3941b/eyJpdiI6Iit0WnYwR2dyYWRzZFQ1V0VPdlVXWmc9PSIsImVuY3J5cHRlZCI6IjdmNVd4VGpaVS92WDdzWVU5Z0pmVVZ4R3NsUm5XSFQwREwveW5BMnJTTUk9IiwidHlwZSI6ImFpb0VuY3J5cHQifQ/manifest.json">התקנה ב‑Stremio</a>
          <button class="btn small copy" data-copy="stremio://noamin25-aiostreams.elfhosted.com/stremio/a9b22ed7-e337-4471-9480-a66f64f3941b/eyJpdiI6Iit0WnYwR2dyYWRzZFQ1V0VPdlVXWmc9PSIsImVuY3J5cHRlZCI6IjdmNVd4VGpaVS92WDdzWVU5Z0pmVVZ4R3NsUm5XSFQwREwveW5BMnJTTUk9IiwidHlwZSI6ImFpb0VuY3J5cHQifQ/manifest.json">העתק קישור</button>
          <button class="btn small share" data-title="AIostreams (Elfhosted)" data-url="stremio://noamin25-aiostreams.elfhosted.com/stremio/a9b22ed7-e337-4471-9480-a66f64f3941b/eyJpdiI6Iit0WnYwR2dyYWRzZFQ1V0VPdlVXWmc9PSIsImVuY3J5cHRlZCI6IjdmNVd4VGpaVS92WDdzWVU5Z0pmVVZ4R3NsUm5XSFQwREwveW5BMnJTTUk9IiwidHlwZSI6ImFpb0VuY3J5cHQifQ/manifest.json">שתף</button>
        </div>
        <details style="margin-top:8px"><summary>להציג את כתובת התוסף</summary>
          <div class="addon-link">stremio://noamin25-aiostreams.elfhosted.com/stremio/a9b22ed7-e337-4471-9480-a66f64f3941b/eyJpdiI6Iit0WnYwR2dyYWRzZFQ1V0VPdlVXWmc9PSIsImVuY3J5cHRlZCI6IjdmNVd4VGpaVS92WDdzWVU5Z0pmVVZ4R3NsUm5XSFQwREwveW5BMnJTTUk9IiwidHlwZSI6ImFpb0VuY3J5cHQifQ/manifest.json</div>
        </details>
        <div class="rate" aria-label="דירוג קהילתי" data-key="rate:aio">
          <span>דירוג:</span>
          <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span>
          <span class="avg" aria-live="polite"></span>
        </div>
      </article>

      <!-- Custom Addon Builder -->
      <article class="card span-12" id="builder">
        <div class="pill">תוסף מותאם אישית</div>
        <h3>הוספת תוסף אחר</h3>
        <p>יש לכם קישור <span class="k">stremio://…/manifest.json</span>? הדביקו כאן ונייצר כרטיס עם כפתורי התקנה, העתקה ושיתוף. זיהוי אוטומטי בעת הדבקה.</p>
        <label class="muted" for="custom-url">קישור לתוסף:</label>
        <input id="custom-url" class="input" placeholder="stremio://example.com/manifest.json" autocomplete="off" />
        <div class="addon-actions">
          <button class="btn small" id="make-addon">צור כרטיס תוסף</button>
          <button class="btn small" id="test-addon">בדוק זמינות</button>
        </div>
        <div id="custom-holder" class="grid" style="margin-top:10px;"></div>
      </article>
    </div>

    <div class="section-title" id="guide" style="margin-top:22px;">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.6"/></svg>
      <h2>מדריך קצר: התקנה, סנכרון, וסטרימר</h2>
    </div>

    <article class="card">
      <h3>1) התקנת Stremio למחשב</h3>
      <ol class="list">
        <li>לחצו על <a href="https://www.strem.io/download?platform=windows&four=true" target="_blank" rel="noopener">הורדה ל‑Windows</a> והתקינו.</li>
        <li>פתחו את Stremio והיכנסו/צרו חשבון — הסנכרון בין מכשירים קורה דרך החשבון.</li>
      </ol>

      <h3>2) התקנת תוספי כתוביות</h3>
      <ol class="list">
        <li>במחשב: לחיצה על <span class="k">התקנה ב‑Stremio</span> תנסה לפתוח את האפליקציה.</li>
        <li>אם זה לא נפתח: הציגו את הכתובת בכרטיס והעתיקו ל‑Stremio (Add‑ons ▸ Community).</li>
      </ol>

      <h3>3) סטרימר (Android TV / Google TV / Fire TV)</h3>
      <ol class="list">
        <li>התקינו את אפליקציית Stremio בסטרימר והתחברו עם <strong>אותו חשבון</strong>.</li>
        <li>לאחר ההתחברות, התוספים המשויכים לחשבון יופיעו אוטומטית.</li>
        <li>בניגון, אפשר לבחור נגן חיצוני (כמו VLC) אם מעדיפים.</li>
      </ol>

      <h3>4) סנכרון מהיר בין מכשירים</h3>
      <ul class="list">
        <li>ברירת המחדל: הסנכרון קורה דרך החשבון.</li>
        <li>בדיקה: בלשונית <span class="k">Add‑ons ▸ Installed</span> רואים מה מותקן במכשיר.</li>
      </ul>

      <details style="margin-top:8px">
        <summary>פתרון תקלות קצר</summary>
        <ul class="list">
          <li><strong>כפתור ההתקנה לא פותח:</strong> העתיקו את הקישור ידנית ל‑Stremio (Add‑ons ▸ Community).</li>
          <li><strong>כתוביות לא מופיעות:</strong> בדקו את שפת ברירת המחדל בהגדרות הנגן ונסו מקור כתוביות נוסף.</li>
          <li><strong>התוספים לא מסתנכרנים:</strong> ודאו התחברות לאותו חשבון ובדקו חיבור אינטרנט.</li>
        </ul>
      </details>
    </article>
  </main>

  <!-- כפתור צף לטלגרם -->
  <a class="fab" href="https://t.me/stremioedil" target="_blank" rel="noopener" title="הצטרפות לקבוצת טלגרם" aria-label="הצטרפות לקבוצת טלגרם">
    <span aria-hidden="true">✈️</span>
    <span class="label">הצטרפות לקבוצת טלגרם</span>
    <span class="label-short">טלגרם</span>
  </a>

  <!-- מודאל מדריך אינטראקטיבי -->
  <div class="modal" id="guide-modal" role="dialog" aria-modal="true" aria-labelledby="guide-title">
    <div class="sheet">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
        <h3 id="guide-title" style="margin:0">מדריך אינטראקטיבי מהיר</h3>
        <button class="btn small" id="close-guide" aria-label="סגור מדריך">סגור</button>
      </div>
      <ol class="list" style="margin-top:10px">
        <li><strong>התקנה:</strong> הורידו את Stremio, התחברו לחשבון. ניתן לגרור קישורים ישירות לאפליקציה.</li>
        <li><strong>תוספים:</strong> לחצו על “התקנה ב‑Stremio”. אם לא נפתח — פתחו Stremio → Add‑ons → Community וחפשו את שם התוסף או הדביקו את הכתובת.</li>
        <li><strong>סטרימר:</strong> התקינו בסטרימר והתחברו לאותו חשבון. התוספים יופיעו אוטומטית.</li>
        <li><strong>טיפים:</strong> העדיפו VLC כנגן חיצוני במכשירים חלשים; עדכנו תוספים אחת לתקופה.</li>
      </ol>
    </div>
  </div>

  <script>
    // ===== Utility =====
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const $ = (sel, ctx=document) => ctx.querySelector(sel);

    // ===== Progress bar when trying to open stremio:// =====
    function runProgress(){
      const bar = document.getElementById('open-progress');
      bar.classList.add('running');
      bar.style.width = '30%';
      setTimeout(()=> bar.style.width='70%', 500);
      setTimeout(()=> { bar.style.width='100%'; bar.classList.remove('running'); bar.style.width='0%'; }, 2300);
    }

    // ===== Guide modal =====
    document.getElementById('open-guide').addEventListener('click', (e)=>{
      e.preventDefault();
      document.getElementById('guide-modal').classList.add('open');
    });
    document.getElementById('close-guide').addEventListener('click', ()=>{
      document.getElementById('guide-modal').classList.remove('open');
    });
    document.getElementById('guide-modal').addEventListener('click', (e)=>{
      if(e.target.id==='guide-modal') e.currentTarget.classList.remove('open');
    });

    // ===== Attempt to detect protocol support (heuristic) =====
    (function protoCheck(){
      const notice = document.getElementById('proto-notice');
      // No reliable API; we use a heuristic with timeout after attempting to open a no-op link
      let opened = false; let timer;
      const testLink = document.createElement('a');
      testLink.href = 'stremio://noop';
      testLink.style.display='none';
      document.body.appendChild(testLink);
      const start = Date.now();
      // Try to open and then quickly show a generic message; this won't be perfect but gives feedback.
      setTimeout(()=>{
        if(Date.now()-start < 1200){ notice.textContent = 'ייתכן שהדפדפן לא מזהה stremio:// — אין בעיה, לכל כרטיס יש כפתור העתקה ושיתוף.'; }
        else { notice.textContent = 'נראה שהדפדפן מזהה stremio://. לחיצה תנסה לפתוח את Stremio.'; }
      }, 800);
      setTimeout(()=> document.body.removeChild(testLink), 1200);
    })();

    // ===== Copy / Share =====
    async function copyText(t){
      try{ await navigator.clipboard.writeText(t); return true; }catch{ return false; }
    }
    $$('.copy').forEach(btn => btn.addEventListener('click', async ()=>{
      const ok = await copyText(btn.dataset.copy);
      btn.textContent = ok ? 'הועתק ✓' : 'שגיאה בהעתקה';
      setTimeout(()=> btn.textContent='העתק קישור', 1500);
    }));

    $$('.share').forEach(btn => btn.addEventListener('click', async ()=>{
      const {title, url} = btn.dataset;
      if(navigator.share){
        try{ await navigator.share({title: 'תוסף ל‑Stremio — '+title, text: title, url}); }
        catch(e){}
      } else {
        await copyText(url);
        btn.textContent = 'הועתק לשיתוף ✓';
        setTimeout(()=> btn.textContent='שתף', 1500);
      }
    }));

    // ===== Open stremio:// with fallback hint =====
    $$('.open-stremio').forEach(a => a.addEventListener('click', ()=>{
      runProgress();
      // After 2 sec, if app didn't open, show a hint (non-invasive)
      setTimeout(()=>{
        const tip = document.createElement('div');
        tip.className='notice';
        tip.textContent='לא נפתח? העתיקו את הקישור מהכרטיס והדביקו ב‑Stremio (Add‑ons ▸ Community).';
        a.closest('[data-addon]').appendChild(tip);
      }, 2000);
    }));

    // ===== Rating (localStorage only, simple avg) =====
    function loadRating(key){ return JSON.parse(localStorage.getItem(key) || '[]'); }
    function saveRating(key, arr){ localStorage.setItem(key, JSON.stringify(arr)); }
    function initRating(block){
      const key = block.dataset.key;
      const stars = $$('.star', block);
      const avgEl = $('.avg', block);
      const data = loadRating(key);
      function render(){
        const sum = data.reduce((a,b)=>a+b,0); const avg = data.length? (sum/data.length).toFixed(1): '-';
        avgEl.textContent = `(${avg}${avg==='-'?'':'★'} / ${data.length} דירוגים)`;
      }
      stars.forEach((s, i)=>{
        s.addEventListener('click', ()=>{ data.push(i+1); saveRating(key, data); highlight(i+1); render(); });
      });
      function highlight(n){ stars.forEach((s, idx)=> s.classList.toggle('on', idx < n)); }
      highlight(Math.round((data.reduce((a,b)=>a+b,0)/(data.length||1))));
      render();
    }
    $$('.rate').forEach(initRating);

    // ===== Health check: try fetching manifest over https (if CORS allows) =====
    async function checkAddon(el){
      const link = $('.open-stremio', el)?.getAttribute('href') || '';
      const pill = $('.pill', el); const dot = $('.dot', el); const status = $('.status-text', el);
      if(!link){ return; }
      try{
        const httpsURL = link.replace('stremio://', 'https://');
        const res = await fetch(httpsURL, { method:'GET', mode:'no-cors' });
        // With no-cors we cannot read status; assume ok if no network error occurred
        dot.classList.add('ok'); status.textContent='זמין (בדיקה בסיסית)';
      } catch(e){ dot.classList.add('bad'); status.textContent='לא זמין כרגע'; pill.style.borderColor='var(--bad)'; }
    }
    $$('[data-addon]').forEach(checkAddon);

    // ===== Custom Addon Builder =====
    const makeBtn = document.getElementById('make-addon');
    const testBtn = document.getElementById('test-addon');
    const input = document.getElementById('custom-url');
    const holder = document.getElementById('custom-holder');

    function valid(url){ return /^stremio:\/\/.+\/manifest\.json$/i.test(url); }

    function buildCard(url){
      const el = document.createElement('article');
      el.className = 'card span-6';
      el.setAttribute('data-addon','');
      el.innerHTML = `
        <div class="pill">תוסף מותאם אישית <span class="status"><span class="dot" aria-hidden="true"></span><span class="status-text">בודק…</span></span></div>
        <h3>תוסף פרטי</h3>
        <p class="muted">נוצר מכאן.</p>
        <div class="addon-actions">
          <a class="btn primary small pill open-stremio" href="${url}">התקנה ב‑Stremio</a>
          <button class="btn small copy" data-copy="${url}">העתק קישור</button>
          <button class="btn small share" data-title="תוסף פרטי" data-url="${url}">שתף</button>
        </div>
        <details style="margin-top:8px">
          <summary>להציג את כתובת התוסף</summary>
          <div class="addon-link">${url}</div>
        </details>
      `;
      holder.appendChild(el);
      // Wire up handlers in the new card
      $('.copy', el).addEventListener('click', async (ev)=>{
        const ok = await copyText(url);
        ev.currentTarget.textContent = ok ? 'הועתק ✓' : 'שגיאה בהעתקה';
        setTimeout(()=> ev.currentTarget.textContent='העתק קישור', 1500);
      });
      $('.share', el).addEventListener('click', async ()=>{
        if(navigator.share){ await navigator.share({title:'תוסף ל‑Stremio', text:'קישור לתוסף', url}); }
        else { await copyText(url); }
      });
      $('.open-stremio', el).addEventListener('click', runProgress);
      checkAddon(el);
    }

    makeBtn?.addEventListener('click', ()=>{
      const url = (input.value||'').trim();
      if(!valid(url)) { alert('נא להזין קישור תקין בפורמט stremio://…/manifest.json'); return; }
      buildCard(url); input.value=''; input.focus();
    });

    // Auto-build on valid paste/input
    input.addEventListener('input', (e)=>{
      const v = e.target.value.trim();
      if(valid(v)) { buildCard(v); e.target.value=''; }
    });

    // Test availability for pasted URL without creating a card
    testBtn?.addEventListener('click', async ()=>{
      const url = (input.value||'').trim();
      if(!valid(url)) { alert('קישור לא תקין'); return; }
      try{
        await fetch(url.replace('stremio://','https://'), {mode:'no-cors'});
        alert('נראה תקין (בדיקה בסיסית — ייתכנו מגבלות CORS)');
      }catch{ alert('לא ניתן לגשת לקישור (יתכן לא פעיל)'); }
    });

    // ===== PWA minimal (single‑file SW via Blob) =====
    if('serviceWorker' in navigator){
      const swCode = `self.addEventListener('install',e=>{e.waitUntil(caches.open('stremio-pro-v1').then(c=>c.addAll(['./'])))});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`;
      const blob = new Blob([swCode], {type:'text/javascript'});
      const url = URL.createObjectURL(blob);
      navigator.serviceWorker.register(url).catch(()=>{});
    }
  </script>
</body>
</html>

